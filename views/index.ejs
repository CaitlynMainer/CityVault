<main class="grid grid-cols-1 lg:grid-cols-5 gap-8">
  <!-- News Column (2/5 width on large screens) -->
  <section class="lg:col-span-2">
    <h2 class="text-2xl font-bold mb-4"><span class="font-paragon"><%= config.siteName %> News</span></h2>
    <% if (news.length === 0) { %>
      <p>No news posts available.</p>
    <% } %>
    <% news.forEach(post => { %>
      <article class="mb-6 p-4 border border-gray-700 rounded">
        <h3 class="text-xl font-semibold"><span class="font-paragon"><%= post.title %></span></h3>
        <div class="prose prose-invert max-w-none">
          <%- post.content %>
        </div>
      </article>
    <% }) %>
  </section>

  <!-- Widget Grid (3/5 width on large screens) -->
  <section class="lg:col-span-3 grid grid-cols-1 md:grid-cols-2 gap-6">
    
    <!-- Recently Online -->
    <section>
      <h2 class="text-xl font-bold mb-2"><span class="font-paragon">Recently Online</span></h2>
      <ul class="grid gap-2 text-sm" style="grid-template-columns: repeat(auto-fit, minmax(167px, 1fr));">
        <% recent.forEach(char => { %>
          <li class="border border-gray-700 p-2 rounded hover:bg-gray-800 transition
           <%= char.bannerClass %> bg-center bg-cover bg-no-repeat banner-hover">
            <a href="/character/<%= char.serverKey %>:<%= char.ContainerId %>" class="block no-underline text-white text-shadow">
              <strong class="break-words"><%= stringClean(char.Name) %></strong><br>
              Level <%= char.Level %> <%= char.Archetype.replace(/^class_/, '')
            .replace(/^.*?:/, '')
            .replace(/_/g, ' ')
            .replace(/\b\w/g, c => c.toUpperCase()); %><br>
              <span class="text-gray-400 text-xs">Last seen: <%= new Date(char.LastActive).toLocaleDateString() %></span>
            </a>
          </li>
        <% }) %>
      </ul>
    </section>

    <!-- Quick Stats -->
    <section>
      <h2 class="text-xl font-bold mb-2"><span class="font-paragon">Quick Stats</span></h2>
      <ul class="text-sm space-y-1">
        <li><strong><span class="font-paragon">Online Now:</span></strong> <%= stats.onlineNow.toLocaleString() %></li>
        <li><strong><span class="font-paragon">Online Today:</span></strong> <%= stats.onlineToday.toLocaleString() %></li>
        <li><strong><span class="font-paragon">Online This Month:</span></strong> <%= stats.onlineMonth.toLocaleString() %></li>
        <li><strong><span class="font-paragon">Total Tracked Characters:</span></strong> <%= stats.totalChars.toLocaleString() %></li>
        <li><strong><span class="font-paragon">Total Hero 50s:</span></strong> <%= stats.hero50s %></li>
        <li><strong><span class="font-paragon">Total Villain 50s:</span></strong> <%= stats.villain50s.toLocaleString() %></li>
        <li><strong><span class="font-paragon">Average Level:</span></strong> <%= Math.round(stats.avgLevel) %></li>
        <li><strong><span class="font-paragon">Average Influence:</span></strong> <%= stats.avgInfluence.toLocaleString() %></li>
        <li><strong><span class="font-paragon">Top Archetypes:</span></strong>
          <%= Object.entries(stats.archetypeCounts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3)
            .map(([key, count]) =>
              key
                .replace(/^class_/, '')
                .replace(/^.*?:/, '')
                .replace(/_/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase()) + ' (' + count.toLocaleString() + ')'
            ).join(', ')
          %>
        </li>

        <li><strong><span class="font-paragon">Top Origins:</span></strong>
          <%= Object.entries(stats.originCounts)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3)
            .map(([key, count]) =>
              key
                .replace(/_/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase()) + ' (' + count.toLocaleString() + ')'
            ).join(', ')
          %>
        </li>
      </ul>
    </section>

    <!-- Character Birthdays -->
    <section class="mt-6 md:mt-0">
      <h2 class="text-xl font-bold mb-2"><span class="font-paragon">Character Birthdays</span></h2>
      <ul class="grid gap-2 text-sm" style="grid-template-columns: repeat(auto-fit, minmax(167px, 1fr));">
        <% birthdays.forEach(char => { %>
          <li class="border border-gray-700 p-2 rounded hover:bg-gray-800 transition
           <%= char.bannerClass %> bg-center bg-cover bg-no-repeat banner-hover">
            <a href="/character/<%= char.serverKey %>:<%= char.ContainerId %>" class="block no-underline text-white text-shadow">
              <strong class="break-words"><%= stringClean(char.Name) %></strong><br>
              Level <%= char.Level %> <%= char.Archetype.replace(/^class_/, '')
            .replace(/^.*?:/, '')
            .replace(/_/g, ' ')
            .replace(/\b\w/g, c => c.toUpperCase()); %><br>
              <span class="text-gray-400 text-xs">Created on <%= new Date(char.DateCreated).toLocaleDateString() %></span>
            </a>
          </li>
        <% }) %>
      </ul>
      <% if (moreBirthdays > 0) { %>
        <p>
          <a href="/birthdays">
            ...and <%= moreBirthdays %> other<%= moreBirthdays > 1 ? 's' : '' %>
          </a>
        </p>
      <% } %>
    </section>

    <!-- Badge Spotlight -->
    <section class="mt-6 md:mt-0">
      <h2 class="text-xl font-bold mb-2 flex items-center gap-2">
        <%- tooltip('<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" /></svg>', `Only characters with at least ${minBadges} badges are featured here.`) %>
        <span class="font-paragon">Badge Spotlight</span>
      </h2>
      <ul class="grid gap-2 text-sm" style="grid-template-columns: repeat(auto-fit, minmax(167px, 1fr));">
        <% badgeSpotlight.forEach(char => { %>
          <li class="border border-gray-700 p-2 rounded hover:bg-gray-800 transition
           <%= char.bannerClass %> bg-center bg-cover bg-no-repeat banner-hover">
            <a href="/character/<%= char.serverKey %>:<%= char.ContainerId %>" class="block no-underline text-white text-shadow">
              <strong class="break-words"><%= stringClean(char.Name) %></strong><br>
              Level <%= char.Level %> <%= char.Archetype.replace(/^class_/, '')
            .replace(/^.*?:/, '')
            .replace(/_/g, ' ')
            .replace(/\b\w/g, c => c.toUpperCase()); %><br>
              Total Badges: <%= char.badgeCount.toLocaleString() %><br>
              <span class="text-gray-400 text-xs">Last Active: <%= new Date(char.LastActive).toLocaleDateString() %></span>
            </a>
          </li>
        <% }) %>
      </ul>
    </section>

  </section>
</main>
