<% if (update.updateAvailable) { %>
  <div id="updateBanner" data-version="<%= update.latestVersion %>" class="relative bg-yellow-900 text-yellow-100 p-4 rounded mb-6">
    <button onclick="toggleUpdateDetails(event)" 
            class="absolute top-2 right-2 text-yellow-200 hover:text-white text-sm font-bold">
      ⮝
    </button>
    <h2 class="text-xl font-bold mb-2">⚠️ Update Available</h2>
    <p>
      Version <strong><%= update.latestVersion %></strong> is available. 
      You are running <strong><%= update.currentVersion %></strong>.
    </p>
    <a href="https://github.com/CaitlynMainer/CityVault/releases/latest" target="_blank"
       class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded inline-block mt-2 mb-4">
      ⬇ DOWNLOAD UPDATE
    </a>

    <div id="updateDetails" class="transition-all overflow-hidden">
      <% update.notes.forEach(note => { %>
        <div class="mb-6">
          <strong><%= note.name %></strong>
          <ul class="pl-6 mt-1 list-disc text-sm">
            <% note.lines.slice(0, 6).forEach(line => { %>
              <li><%= line %></li>
            <% }) %>
          </ul>
          <% if (note.lines.length > 6) { %>
            <a href="<%= note.url %>" target="_blank" class="text-blue-400 text-xs underline">
              ...see full changelog for <%= note.version %>
            </a>
          <% } %>
        </div>
      <% }) %>
    </div>
  </div>
<% } %>

    <h1 class="text-3xl font-bold  mb-4"><span class="font-paragon">Admin Dashboard</span></h1>

    <p class="mb-6 ">Welcome<% if (user) { %>, <strong>
          <%= user.username %>
        </strong>
        <% } %>.</p>

    <div class="grid grid-cols-1 xl:grid-cols-2 2xl:grid-cols-3 gap-4 mb-8">

      <% if (links && links.length) { %>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
          <% links.forEach(link=> { %>
            <a href="<%= link.path %>"
              class="bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 p-4 rounded shadow flex items-center space-x-2 text-black dark:text-white transition-colors duration-200">
              <span>
                <%= link.icon %>
              </span>
              <span>
                <%= link.label %>
              </span>
            </a>
            <% }) %>
        </div>
        <% } %>
    </div>


    <a href="/" class="text-blue-400 hover:underline">← Back to Site</a>
<script>
  let collapsed = false;

  document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById('updateBanner');
    const panel = document.getElementById('updateDetails');
    const button = banner?.querySelector('button');

    const currentVersion = banner?.dataset.version;
    const seenVersion = localStorage.getItem('updateVersionSeen');

    if (currentVersion && currentVersion !== seenVersion) {
      localStorage.removeItem('updateCollapsed');
      localStorage.setItem('updateVersionSeen', currentVersion);
    }

    collapsed = localStorage.getItem('updateCollapsed') === 'true';

    if (panel) {
      panel.style.overflow = 'hidden';
      panel.style.transition = 'max-height 0.3s ease, opacity 0.3s ease';

      if (collapsed) {
        panel.style.maxHeight = '0px';
        panel.style.opacity = '0';
        if (button) button.innerHTML = '⮟';
      } else {
        panel.style.maxHeight = panel.scrollHeight + 'px';
        panel.style.opacity = '1';
        if (button) button.innerHTML = '⮝';
      }
    }
  });

  function toggleUpdateDetails(event) {
    const panel = document.getElementById('updateDetails');
    const button = event.currentTarget;

    collapsed = !collapsed;
    localStorage.setItem('updateCollapsed', collapsed ? 'true' : 'false');

    if (collapsed) {
      panel.style.maxHeight = '0px';
      panel.style.opacity = '0';
      button.innerHTML = '⮟';
    } else {
      panel.style.maxHeight = panel.scrollHeight + 'px';
      panel.style.opacity = '1';
      button.innerHTML = '⮝';
    }
  }
</script>

