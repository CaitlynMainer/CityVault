<h1 class="text-2xl font-bold mb-6"><span class="font-paragon">ðŸ†˜ Petitions</span></h1>

<table class="min-w-full table-auto border border-gray-300 dark:border-gray-700 text-sm text-left text-gray-800 dark:text-gray-300 bg-white dark:bg-gray-900 rounded shadow">
  <thead class="bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 uppercase text-xs">
    <tr>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Date</span></th>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Server</span></th>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Name</span></th>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Summary</span></th>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Fetched</span></th>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Done</span></th>
      <th class="px-4 py-2 border-b border-gray-300 dark:border-gray-700"><span class="font-paragon">Actions</span></th>
    </tr>
  </thead>
  <tbody>
    <% petitions.forEach(p => { %>
      <tr class="hover:bg-gray-100 dark:hover:bg-gray-800 transition">
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700 whitespace-nowrap">
          <%= new Date(p.Date).toLocaleString() %>
        </td>
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400">
          <%= p.serverKey %>
        </td>
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700 font-medium text-gray-900 dark:text-white">
          <%= p.Name %>
        </td>
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700 text-yellow-600 dark:text-yellow-300">
          <%= p.Summary %>
        </td>
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700">
          <%= p.Fetched ? 'âœ…' : 'âŒ' %>
        </td>
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700">
          <%= p.Done ? 'âœ…' : 'âŒ' %>
        </td>
        <td class="px-4 py-2 border-b border-gray-300 dark:border-gray-700">
          <a href="/admin/petitions/<%= p.serverKey %>/<%= p.ContainerId %>"
             class="text-blue-600 dark:text-blue-400 hover:underline">
            View
          </a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<% if (totalPages > 1) { %>
  <div class="mt-4 flex flex-wrap justify-between items-center text-sm text-gray-600 dark:text-gray-400 gap-4">
    <div>
      Page <%= currentPage %> of <%= totalPages %> â€” <%= totalItems %> total
    </div>

    <div class="flex flex-wrap items-center gap-2">

      <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>"
           class="px-3 py-1 rounded border bg-gray-200 text-black border-gray-400 hover:bg-gray-300
                  dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700">
          Â« Prev
        </a>
      <% } %>

      <% const windowSize = 2; %>
      <% for (let i = 1; i <= totalPages; i++) {
           const alwaysShow = i <= 2 || i > totalPages - 2;
           const nearPage = Math.abs(i - currentPage) <= windowSize;
           const showPage = alwaysShow || nearPage;

           if (showPage) { %>
             <a href="?page=<%= i %>"
                class="px-3 py-1 rounded border text-sm
                  <%= currentPage === i
                    ? 'bg-blue-600 text-white border-blue-700'
                    : 'bg-gray-200 text-black border-gray-400 hover:bg-gray-300 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700' %>">
               <%= i %>
             </a>
      <%   } else if (
             (i === 3 && currentPage > 5) ||
             (i === totalPages - 2 && currentPage < totalPages - 4) ||
             (i === currentPage - windowSize - 1) ||
             (i === currentPage + windowSize + 1)
           ) { %>
             <span class="px-3 py-1 text-sm text-gray-400 dark:text-gray-500">â€¦</span>
      <% } %>
      <% } %>

      <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>"
           class="px-3 py-1 rounded border bg-gray-200 text-black border-gray-400 hover:bg-gray-300
                  dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700">
          Next Â»
        </a>
      <% } %>

      <!-- Optional mobile dropdown -->
      <div class="ml-4 block sm:hidden">
        <select onchange="location.href='?page=' + this.value"
                class="bg-gray-200 text-black text-sm border border-gray-400 rounded px-2 py-1
                       dark:bg-gray-800 dark:text-white dark:border-gray-600">
          <% for (let i = 1; i <= totalPages; i++) { %>
            <option value="<%= i %>" <%= currentPage === i ? 'selected' : '' %>>Page <%= i %></option>
          <% } %>
        </select>
      </div>

    </div>
  </div>
<% } %>

<script>
document.addEventListener('keydown', function (e) {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

  <% if (currentPage > 1) { %>
    if (e.key === 'ArrowLeft') {
      window.location.href = "?page=<%= currentPage - 1 %>";
    }
  <% } %>
  <% if (currentPage < totalPages) { %>
    if (e.key === 'ArrowRight') {
      window.location.href = "?page=<%= currentPage + 1 %>";
    }
  <% } %>
});
</script>
